{"version":3,"file":"yourls.min.js","sources":["../node_modules/oopsy/src/oopsy.js","../src/util/extend.js","../src/util/array.js","../src/api.js","../src/request/request.js","../src/request/json.js","../src/request/jsonp.js","../src/request/requestor.js","../src/yourls-db.js","../src/yourls-url.js","../src/yourls.js"],"sourcesContent":["/*\n * Copyright (C) 2016 Alasdair Mercer, Skelp\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * A bare-bones constructor for surrogate prototype swapping.\n *\n * @private\n * @constructor\n */\nvar Constructor = function() {}\n/**\n * A reference to <code>Object.prototype.hasOwnProperty</code>.\n *\n * @private\n * @type {Function}\n */\nvar hasOwnProperty = Object.prototype.hasOwnProperty\n/**\n * A reference to <code>Array.prototype.slice</code>.\n *\n * @private\n * @type {Function}\n */\nvar slice = Array.prototype.slice\n\n/**\n * Extends the specified <code>target</code> object with the properties in each of the <code>sources</code> provided.\n *\n * Nothing happens if <code>target</code> is <code>null</code> and if any source is <code>null</code> it will be\n * ignored.\n *\n * @param {boolean} own - <code>true</code> to only copy <b>own</b> properties from <code>sources</code> onto\n * <code>target</code>; otherwise <code>false</code>\n * @param {Object} [target] - the target object which should be extended\n * @param {...Object} [sources] - the source objects whose properties are to be copied onto <code>target</code>\n * @return {void}\n * @private\n */\nfunction extend(own, target, sources) {\n  if (target == null) {\n    return\n  }\n\n  sources = slice.call(arguments, 2)\n\n  var property\n  var source\n\n  for (var i = 0, length = sources.length; i < length; i++) {\n    source = sources[i]\n\n    for (property in source) {\n      if (!own || hasOwnProperty.call(source, property)) {\n        target[property] = source[property]\n      }\n    }\n  }\n}\n\n/**\n * Creates an object which inherits the given <code>prototype</code>.\n *\n * Optionally, the created object can be extended further with the specified <code>properties</code>.\n *\n * @param {Object} prototype - the prototype to be inherited by the created object\n * @param {Object} [properties] - the optional properties to be extended by the created object\n * @return {Object} The newly created object.\n * @private\n */\nfunction create(prototype, properties) {\n  var result\n  if (typeof Object.create === 'function') {\n    result = Object.create(prototype)\n  } else {\n    Constructor.prototype = prototype\n    result = new Constructor()\n    Constructor.prototype = null\n  }\n\n  if (properties) {\n    extend(true, result, properties)\n  }\n\n  return result\n}\n\n/**\n * The base constructor from which all others should extend.\n *\n * @public\n * @constructor\n */\nexport default function Oopsy() {}\n\n/**\n * Extends the constructor to which this method is associated with the <code>prototype</code> and/or\n * <code>statics</code> provided.\n *\n * If <code>constructor</code> is provided, it will be used as the constructor for the child, otherwise a simple\n * constructor which only calls the super constructor will be used instead.\n *\n * The super constructor can be accessed via a special <code>super_</code> property on the child constructor.\n *\n * @param {Function} [constructor] - the constructor for the child\n * @param {Object} [prototype] - the prototype properties to be defined for the child\n * @param {Object} [statics] - the static properties to be defined for the child\n * @return {Function} The child <code>constructor</code> provided or the one created if none was given.\n * @public\n * @static\n */\nOopsy.extend = function(constructor, prototype, statics) {\n  var superConstructor = this\n\n  if (typeof constructor !== 'function') {\n    statics = prototype\n    prototype = constructor\n    constructor = function() {\n      return superConstructor.apply(this, arguments)\n    }\n  }\n\n  extend(false, constructor, superConstructor, statics)\n\n  constructor.prototype = create(superConstructor.prototype, prototype)\n  constructor.prototype.constructor = constructor\n\n  constructor.super_ = superConstructor\n\n  return constructor\n}\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * Extends the specified <code>target</code> object with the properties in each of the <code>sources</code> provided.\n *\n * Any of the <code>sources</code> that are <code>null</code> will simply be ignored.\n *\n * @param {Object} target - the target object which should be extended\n * @param {...Object} [sources] - the source objects whose properties are to be copied onto <code>target</code>\n * @return {Object} A reference to <code>target</code>.\n * @protected\n */\nexport function extend(target, sources) {\n  sources = Array.prototype.slice.call(arguments, 1)\n\n  for (var i = 0, length = sources.length, property, source; i < length; i++) {\n    source = sources[i]\n\n    if (source) {\n      for (property in source) {\n        if (Object.prototype.hasOwnProperty.call(source, property)) {\n          target[property] = source[property]\n        }\n      }\n    }\n  }\n\n  return target\n}\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * Returns whether the specified <code>obj</code> is an array.\n *\n * This method will use the native <code>Array.isArray</code>, if available.\n *\n * @param {*} obj - the object to be checked (may be <code>null</code>)\n * @return {boolean} <code>true</code> if <code>obj</code> is an array; otherwise <code>false</code>.\n * @protected\n */\nexport function isArray(obj) {\n  return Array.isArray ? Array.isArray(obj) : Object.prototype.toString.call(obj) === '[object Array]'\n}\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Oopsy from 'oopsy'\n\n/**\n * Contains information on how to connect to and authenticate with a YOURLS server.\n *\n * @param {string} [url=''] - the URL for the YOURLS server\n * @param {API~Credentials} [credentials] - the credentials to be used to authenticate with the YOURLS API (may be\n * <code>null</code>)\n * @param {API~Options} [options] - the options to be used to send requests to the YOURLS server (may be\n * <code>null</code>)\n * @protected\n * @constructor\n */\nexport var API = Oopsy.extend(function(url, credentials, options) {\n  /**\n   * The URL of the YOURLS server.\n   *\n   * @public\n   * @type {string}\n   */\n  this.url = url ? url.replace(/\\/$/, '') : ''\n  /**\n   * The credentials to be used to authenticate with the YOURLS API.\n   *\n   * This may be <code>null</code> if the YOURLS API is public.\n   *\n   * @public\n   * @type {API~Credentials}\n   */\n  this.credentials = API._sanitizeCredentials(credentials)\n  /**\n   * The options to be used to send requests to the YOURLS server.\n   *\n   * @public\n   * @type {API~Options}\n   */\n  this.options = API._sanitizeOptions(options)\n}, null, {\n\n  /**\n   * The singleton {@link API} instance which is privatized to prevent leaking credentials.\n   *\n   * @public\n   * @static\n   * @type {API}\n   */\n  instance: null,\n\n  /**\n   * Sanitizes the specified <code>credentials</code> by ensuring that only valid properties are present and only when\n   * appropriate.\n   *\n   * This method does not modify <code>credentials</code> and instead creates a new object with the sanitized\n   * properties.\n   *\n   * @param {API~Credentials} credentials - the credentials to be sanitized (may be <code>null</code>)\n   * @return {API~Credentials} A sanitized version of <code>credentials</code> or <code>null</code> if\n   * <code>credentials</code> is <code>null</code>.\n   * @private\n   * @static\n   */\n  _sanitizeCredentials: function(credentials) {\n    if (!credentials) {\n      return null\n    }\n\n    var result = {}\n    if (credentials.signature) {\n      result.signature = credentials.signature\n      result.timestamp = credentials.timestamp\n    } else {\n      result.password = credentials.password\n      result.username = credentials.username\n    }\n\n    return result\n  },\n\n  /**\n   * Sanitizes the specified <code>options</code> by ensuring that only valid properties are present and in the correct\n   * format.\n   *\n   * This method does not modify <code>options</code> and instead creates a new object with the sanitized properties and\n   * default values will be used for missing options.\n   *\n   * @param {API~Options} options - the options to be sanitized (may be <code>null</code>)\n   * @return {API~Options} A sanitized version of <code>options</code> which will contain only default values if\n   * <code>options</code> is <code>null</code>.\n   * @private\n   * @static\n   */\n  _sanitizeOptions: function(options) {\n    if (options == null) {\n      options = {}\n    }\n\n    var result = { format: 'json' }\n\n    if (options.format) {\n      result.format = options.format.toLowerCase()\n    }\n    if (options.method) {\n      result.method = options.method.toUpperCase()\n    } else {\n      result.method = result.format === 'json' ? 'POST' : 'GET'\n    }\n\n    return result\n  }\n\n})\n\n/**\n * The credentials to be used to authenticate with a private YOURLS API.\n *\n * Authentication can be done with a traditional username and password combination <b>or</b> by using the secret\n * signature token (e.g. <code>1002a612b4</code>)for the YOURLS API. The latter is not available for public YOURLS APIs\n * and can be found on the \"Tools\" page.\n *\n * Optionally, a timestamp can accompany the signature token to make it time-limited (depending on the server\n * configuration). When a timestamp is provided the signature token <b>must</b> be the md5 sum of the timestamp and\n * signature token concatenated, and in that order.\n *\n * @typedef {Object} API~Credentials\n * @property {string} [password] - The password of the user to be authenticated.\n * @property {string} [username] - The name of the user to be authenticated.\n * @property {string} [signature] - The signature token to be used for passwordless authentication with the YOURLS API.\n * @property {number|string} [timestamp] - The optional timestamp to limit the <code>signature</code> token.\n */\n\n/**\n * The options that determine how requests are sent to the YOURLS server.\n *\n * If the request <code>format</code> does not support the HTTP <code>method</code>, requests will not be sent and an\n * error will be thrown when such attempts occur.\n *\n * @typedef {Object} API~Options\n * @property {string} [format=\"json\"] - The format in which requests are sent (either <code>\"json\"</code> or\n * <code>\"jsonp\"</code>).\n * @property {string} [method] - The HTTP method to be used for requests. Defaults to <code>\"POST\"</code> when\n * <code>format</code> is <code>\"json\"</code> and <code>\"GET\"</code> when <code>format</code> is <code>\"jsonp\"</code>.\n */\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Oopsy from 'oopsy'\n\nimport { API } from '../api'\nimport { extend } from '../util/extend'\nimport { isArray } from '../util/array'\n\n/**\n * Contains logic to connect with a YOURLS server and send data to its API.\n *\n * Due to the nature of HTTP, requests sent using a \"GET\" HTTP method will include all information in the URL of the\n * request. This includes the data that is sent as well as <b>any credentials</b> used to authenticate with the API. You\n * have been warned.\n *\n * @constructor\n * @protected\n */\nexport var Request = Oopsy.extend({\n\n  /**\n   * Builds the body for this {@link Request} based on the <code>api</code> and <code>data</code> provided.\n   *\n   * @param {API} api - the {@link API} to which the request is being sent\n   * @param {Object} [data] - the data being sent in this request\n   * @return {Object} The request body.\n   * @protected\n   */\n  buildBody: function(api, data) {\n    return extend({ format: api.options.format }, api.credentials, data)\n  },\n\n  /**\n   * Returns the list of the HTTP methods that are supported by this {@link Request}.\n   *\n   * By default, this method returns <code>null</code>, so implementations <b>must</b> implement this method to ensure\n   * that {@link Request#isMethodSupported} works correctly.\n   *\n   * @return {string[]} The supported HTTP methods.\n   * @protected\n   */\n  getSupportedHttpMethods: function() {\n    return null\n  },\n\n  /**\n   * Determines whether this {@link Request} supports the specified HTTP <code>method</code>.\n   *\n   * @param {string} method - the HTTP method to be checked\n   * @return {boolean} <code>true</code> if <code>method</code> is supported; otherwise <code>false</code>.\n   * @public\n   */\n  isMethodSupported: function(method) {\n    var supportedMethods = this.getSupportedHttpMethods()\n    return supportedMethods && supportedMethods.indexOf(method) !== -1\n  },\n\n  /**\n   * Determines whether the data that is to be sent to the YOURLS server in this {@link Request} must be serialized as\n   * query string parameters.\n   *\n   * @param {string} method - the HTTP method to be used\n   * @return {boolean} <code>true</code> if the data needs to be sent as query string parameters; otherwise\n   * <code>false</code>.\n   * @protected\n   */\n  isQueryStringRequired: function(method) {\n    return method === 'GET'\n  },\n\n  /**\n   * Processes this {@link Request} by sending it to the specified target <code>url</code> containing the\n   * <code>body</code> provided.\n   *\n   * <code>callback</code> should be called with the response regardless of whether the it was a success or failure.\n   *\n   * This method is called internally by {@link Request#send} and does all of the actual work involved to send the\n   * request and parse the response. All implementations <b>must</b> implement this method.\n   *\n   * @param {string} method - the request HTTP method\n   * @param {string} url - the request URL\n   * @param {Object} body - the request body (may be <code>null</code>)\n   * @param {Function} callback - the function to be called with the response\n   * @return {void}\n   * @protected\n   * @abstract\n   */\n  process: function(method, url, body, callback) {\n    // Must be implemented\n  },\n\n  /**\n   * Sends the request to the connected YOURLS API with the <code>data</code> provided which should, in turn, call the\n   * specified <code>callback</code> with the result.\n   *\n   * If the request is successful, <code>callback</code> will be passed the value of the named properties from the\n   * response. If <code>resultNames</code> is a string or only contains a single string, only the value for that named\n   * property will be passed as the first argument. Otherwise, an object containing the key/value pairs for each named\n   * property will be passed as the first argument. The actual response will always be passed as the second argument.\n   *\n   * @param {Object} data - the data to be sent\n   * @param {string|string[]} resultNames - the names of the response properties whose values are to be passed to\n   * <code>callback</code> as the first argument\n   * @param {Function} callback - the function to be called with the result\n   * @return {void}\n   * @public\n   */\n  send: function(data, resultNames, callback) {\n    var api = API.instance\n    var body = Request._serializeParameters(this.buildBody(api, data))\n    var method = api.options.method\n    var url = api.url\n\n    if (this.isQueryStringRequired(method)) {\n      url += '?' + body\n      body = null\n    }\n\n    this.process(method, url, body, function(response) {\n      callback(Request._extractResult(resultNames, response), response)\n    })\n  }\n\n}, {\n\n  /**\n   * Extracts the values of the properties with the specified <code>names</code> from the <code>response</code> provided\n   * and returns them in a single result.\n   *\n   * If <code>names</code> is a string or only contains a single string, only the value for that named property will be\n   * returned. Otherwise, an object containing the key/value pairs for each named property will be returned.\n   *\n   * If <code>response</code> is <code>null</code> this method will return <code>null</code>.\n   *\n   * @param {string|string[]} names - the names of the <code>response</code> properties whose values are to be returned\n   * as the result\n   * @param {Object} response - the YOURLS API response\n   * @return {*} The result extracted from <code>response</code>.\n   * @private\n   * @static\n   */\n  _extractResult: function(names, response) {\n    names = isArray(names) ? names : [ names ]\n\n    var i\n    var name\n    var result = null\n\n    if (!response) {\n      return result\n    }\n\n    if (names.length === 1) {\n      result = response[names[0]]\n    } else {\n      result = {}\n\n      for (i = 0; i < names.length; i++) {\n        name = names[i]\n\n        if (typeof response[name] !== 'undefined') {\n          result[name] = response[name]\n        }\n      }\n    }\n\n    return result\n  },\n\n  /**\n   * Creates a serialized representation of the specified parameters.\n   *\n   * All of the parameter names and values are URL-encoded so that they can be safely included in the query string or\n   * request body.\n   *\n   * @param {Object} [params] - the hash of parameter name/value pairs to be serialized\n   * @return {string} A URL-encoded representing <code>obj</code> or an empty string if <code>obj</code> is\n   * <code>null</code>.\n   * @private\n   * @static\n   */\n  _serializeParameters: function(params) {\n    if (!params) {\n      return ''\n    }\n\n    var results = []\n\n    for (var name in params) {\n      if (Object.prototype.hasOwnProperty.call(params, name) && params[name] != null) {\n        results.push(encodeURIComponent(name) + '=' + encodeURIComponent(params[name]))\n      }\n    }\n\n    return results.join('&')\n  }\n\n})\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Request } from './request'\n\n/**\n * An implementation of {@link Request} that provides support for JSON requests to the YOURLS API.\n *\n * JSON requests can only be sent using the \"GET\" or \"POST\" HTTP methods.\n *\n * @constructor\n * @extends Request\n * @protected\n */\nexport var JSONRequest = Request.extend({\n\n  /**\n   * @inheritDoc\n   * @override\n   */\n  getSupportedHttpMethods: function() {\n    return [ 'GET', 'POST' ]\n  },\n\n  /**\n   * @inheritDoc\n   * @override\n   */\n  process: function(method, url, body, callback) {\n    var xhr = new XMLHttpRequest()\n    xhr.open(method, url, true)\n    xhr.onreadystatechange = function() {\n      var response\n\n      if (xhr.readyState === 4) {\n        try {\n          response = JSON.parse(xhr.responseText)\n          callback(response)\n        } catch (e) {\n          throw new Error('Unable to parse response: ' + e)\n        }\n      }\n    }\n\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')\n    if (body != null) {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n    }\n\n    xhr.send(body)\n  }\n\n})\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Request } from './request'\n\n/**\n * The seed to be used to generate IDs.\n *\n * @private\n * @type {number}\n */\nvar seed = new Date().getTime()\n\n/**\n * An implementation of {@link Request} that provides support for JSONP requests to the YOURLS API.\n *\n * JSONP requests can only be sent using the \"GET\" HTTP method.\n *\n * @constructor\n * @extends Request\n * @protected\n */\nexport var JSONPRequest = Request.extend(function() {\n  JSONPRequest.super_.call(this)\n\n  if (!window[JSONPRequest._callbackHolderKey]) {\n    window[JSONPRequest._callbackHolderKey] = JSONPRequest._callbackHolder\n  }\n\n  /**\n   * The generated ID which is used to store a reference to the callback function within the holder so that the JSONP\n   * payload can find it in the global namespace.\n   *\n   * @private\n   * @type {number}\n   */\n  this._id = JSONPRequest._generateId()\n}, {\n\n  /**\n   * @inheritDoc\n   * @override\n   */\n  getSupportedHttpMethods: function() {\n    return [ 'GET' ]\n  },\n\n  /**\n   * @inheritDoc\n   * @override\n   */\n  buildBody: function(api, data) {\n    var body = JSONPRequest.super_.prototype.buildBody.call(this, api, data)\n    body.callback = JSONPRequest._callbackHolderKey + '[' + this._id + ']'\n\n    return body\n  },\n\n  /**\n   * @inheritDoc\n   * @override\n   */\n  process: function(method, url, body, callback) {\n    var script = document.createElement('script')\n\n    var self = this\n    JSONPRequest._callbackHolder[this._id] = function(response) {\n      delete JSONPRequest._callbackHolder[self._id]\n      script.parentNode.removeChild(script)\n\n      callback(response)\n    }\n\n    script.setAttribute('src', url)\n    document.getElementsByTagName('head')[0].appendChild(script)\n  }\n\n}, {\n\n  /**\n   * The key of the callback function holder within the global namespace.\n   *\n   * @private\n   * @static\n   * @type {string}\n   */\n  _callbackHolderKey: '__yourls' + seed + '_jsonp',\n\n  /**\n   * Contains the callback functions for active JSONP requests.\n   *\n   * Callback references should be removed immediately once they have been called.\n   *\n   * Due to the nature of JSON, a reference to this object <b>must</b> be publicly available (i.e. global).\n   *\n   * @private\n   * @static\n   * @type {Object<number, Function>}\n   */\n  _callbackHolder: {},\n\n  /**\n   * Generates an ID to be used when storing a reference to a callback function.\n   *\n   * @return {number} The generated ID.\n   * @private\n   */\n  _generateId: function() {\n    do {\n      seed++\n    } while (JSONPRequest._callbackHolder[seed])\n\n    return seed\n  }\n\n})\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Oopsy from 'oopsy'\n\nimport { API } from '../api'\nimport { JSONRequest } from './json'\nimport { JSONPRequest } from './jsonp'\n\n/**\n * Can make requests to the connected YOURLS API.\n *\n * @constructor\n * @protected\n */\nexport var Requestor = Oopsy.extend({\n\n  /**\n   * Sends the request to the connected YOURLS API with the <code>data</code> provided which should, in turn, call the\n   * specified <code>callback</code> with the result.\n   *\n   * This method is primarily a proxy to {@link Request#send} but does validate the state of the connection information\n   * to ensure that is is valid before making the request.\n   *\n   * @param {Object} data - the data to be sent\n   * @param {string|string[]} resultNames - the names of the response properties whose values are to be passed to\n   * <code>callback</code> as the first argument\n   * @param {Function} callback - the function to be called with the result\n   * @return {void}\n   * @throws {Error} - If either no connection is present, the request format is not supported, or the configured HTTP\n   * method is not supported by the {@link Request}.\n   * @protected\n   */\n  sendRequest: function(data, resultNames, callback) {\n    var api = API.instance\n\n    if (!api) {\n      throw new Error('No connection has been made')\n    }\n\n    var format = api.options.format\n    var method = api.options.method\n    var Request = Requestor._requestFormatMap[format]\n\n    if (!Request) {\n      throw new Error('Request format not supported: ' + format)\n    }\n\n    var request = new Request()\n\n    if (!request.isMethodSupported(method)) {\n      throw new Error('HTTP method not supported: ' + method)\n    }\n\n    request.send(data, resultNames, callback)\n  }\n\n}, {\n\n  /**\n   * The mapping of supported request formats to {@link Request} constructors.\n   *\n   * @private\n   * @static\n   * @type {Object<string, Function>}\n   */\n  _requestFormatMap: {\n    json: JSONRequest,\n    jsonp: JSONPRequest\n  }\n\n})\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Requestor } from './request/requestor'\n\n/**\n * Provides the ability to lookup information related to the YOURLS database.\n *\n * @constructor\n * @extends Requestor\n * @protected\n */\nexport var DB = Requestor.extend({\n\n  /**\n   * Retrieves the statistics for this {@link DB}.\n   *\n   * @param {Function} callback - the callback function to be called with the result\n   * @return {DB} A reference to this {@link DB} for chaining purposes.\n   * @public\n   */\n  stats: function(callback) {\n    var data = { action: 'db-stats' }\n\n    this.sendRequest(data, 'db-stats', callback)\n\n    return this\n  }\n\n})\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE0\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Requestor } from './request/requestor'\n\n/**\n * Provides the ability to lookup information related to the specified shortened <code>url</code>.\n *\n * @param {string} url - the shortened URL (or its keyword) to be used\n * @constructor\n * @extends Requestor\n * @protected\n */\nexport var URL = Requestor.extend(function(url) {\n  URL.super_.call(this)\n\n  /**\n   * Either the shortened URL or its keyword for this {@link URL}.\n   *\n   * @public\n   * @type {string}\n   */\n  this.url = url\n})\n\n/**\n * Retrieves the original (\"long\") URL for this shortened {@link URL}.\n *\n * @param {Function} callback - the callback function to be called with the result\n * @return {URL} A reference to this {@link URL} for chaining purposes.\n * @public\n */\nURL.prototype.expand = function(callback) {\n  var data = {\n    action: 'expand',\n    shorturl: this.url\n  }\n\n  this.sendRequest(data, [ 'keyword', 'longurl', 'shorturl' ], callback)\n\n  return this\n}\n\n/**\n * Retrieves the statistics for this shortened {@link URL}.\n *\n * @param {Function} callback - the callback function to be called with the result\n * @return {URL} A reference to this {@link URL} for chaining purposes.\n * @public\n */\nURL.prototype.stats = function(callback) {\n  var data = {\n    action: 'url-stats',\n    shorturl: this.url\n  }\n\n  this.sendRequest(data, 'link', callback)\n\n  return this\n}\n","/*\n * Copyright (C) 2017 Alasdair Mercer\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { API } from './api'\nimport { DB } from './yourls-db'\nimport { isArray } from './util/array'\nimport { Requestor } from './request/requestor'\nimport { URL } from './yourls-url'\n\n/**\n * Provides the ability to connect to YOURLS servers and perform read/write operations via the API that they expose.\n *\n * Before attempting to interact with a YOURLS server, you <b>must</b> call {@link YOURLS#connect} first to configure\n * the URL of the YOURLS server and any credentials required to authenticate with its API (only required when private).\n *\n * @constructor\n * @extends Requestor\n * @protected\n */\nvar YOURLS = Requestor.extend(function() {\n  YOURLS.super_.call(this)\n\n  /**\n   * Provides information on the YOURLS {@link DB}.\n   *\n   * @public\n   * @type {DB}\n   */\n  this.db = new DB()\n\n  /**\n   * The current version of <code>yourls</code>.\n   *\n   * This is <b>not</b> the same as the version of YOURLS that is being connected to. The {@link YOURLS#version} method\n   * should be used to provide that information.\n   *\n   * @public\n   * @type {string}\n   */\n  this.VERSION = '3.0.0'\n}, {\n\n  /**\n   * Stores the specified information to be used later to connect to and authenticate with a YOURLS server.\n   *\n   * @param {string} [url=''] - the URL for the YOURLS server\n   * @param {API~Credentials} [credentials] - the credentials to be used to authenticate with the YOURLS API (may be\n   * <code>null</code>)\n   * @param {API~Options} [options] - the options to be used to send requests to the YOURLS server (may be\n   * <code>null</code>)\n   * @return {YOURLS} A reference to this {@link YOURLS} for chaining purposes.\n   * @public\n   */\n  connect: function(url, credentials, options) {\n    API.instance = new API(url, credentials, options)\n\n    return this\n  },\n\n  /**\n   * Clears any information that may have been previously stored for connecting to and authenticating with a YOURLS\n   * server.\n   *\n   * @return {YOURLS} A reference to this {@link YOURLS} for chaining purposes.\n   * @public\n   */\n  disconnect: function() {\n    API.instance = null\n\n    return this\n  },\n\n  /**\n   * Creates a short URL for the specified long <code>url</code>.\n   *\n   * Optionally, a <code>descriptor</code> can be provided to specify a keyword and/or title for the short URL that is\n   * to be created. If a keyword is specified, it must be available and, if not, the YOURLS server will generate a\n   * unique keyword. If <code>descriptor</code> is a string, it will be treated as the keyword.\n   *\n   * @param {string} url - the long URL to be shortened\n   * @param {YOURLS~UrlDescriptor|string} [descriptor] - the optional descriptor (or keyword, if it's a string) to be\n   * used for the short URL\n   * @param {Function} callback - the callback function to be called with the result\n   * @return {YOURLS} A reference to this {@link YOURLS} for chaining purposes.\n   * @public\n   */\n  shorten: function(url, descriptor, callback) {\n    var data = {\n      action: 'shorturl',\n      url: url\n    }\n\n    switch (typeof descriptor) {\n    case 'function':\n      callback = descriptor\n      descriptor = null\n      break\n    case 'string':\n      descriptor = { keyword: descriptor }\n      break\n    default:\n      // Do nothing\n    }\n\n    if (descriptor) {\n      data.keyword = descriptor.keyword\n      data.title = descriptor.title\n    }\n\n    this.sendRequest(data, [ 'shorturl', 'title', 'url' ], callback)\n\n    return this\n  },\n\n  /**\n   * Retrieves the statistics for all shortened URLs.\n   *\n   * Optionally, <code>criteria</code> can be provided to also include a refined set of links in the result. This\n   * includes filter, which provides limited control over the sorting, as well as limit and start, which allow for\n   * pagination. If <code>criteria</code> is a number, it will be treated as the limit.\n   *\n   * No links will be included in the result unless a limit is specified that is greater than zero. In that case, this\n   * method would effectively be doing the same as {@link DB#stats}.\n   *\n   * @param {YOURLS~SearchCriteria|number} [criteria] - the optional criteria (or limit, if it's a number) to be used to\n   * search for links to be included in the result\n   * @param {Function} callback - the callback function to be called with the result\n   * @return {YOURLS} A reference to this {@link YOURLS} for chaining purposes.\n   * @public\n   */\n  stats: function(criteria, callback) {\n    var data = { action: 'stats' }\n\n    switch (typeof criteria) {\n    case 'function':\n      callback = criteria\n      criteria = null\n      break\n    case 'number':\n      criteria = { limit: criteria }\n      break\n    default:\n      // Do nothing\n    }\n\n    if (criteria) {\n      data.filter = criteria.filter\n      data.limit = criteria.limit\n      data.start = criteria.start\n    }\n\n    this.sendRequest(data, [ 'links', 'stats' ], function(result, response) {\n      callback(YOURLS._sanitizeStatsResult(result), response)\n    })\n\n    return this\n  },\n\n  /**\n   * Creates an instance of {@link URL} for the specified shortened <code>url</code> which can be used to lookup more\n   * detailed information relating to it.\n   *\n   * No data is fetched just by calling this method; one of the methods on the returned instance need to be called for\n   * that to happen.\n   *\n   * @param {string} url - the shortened URL (or its keyword)\n   * @return {URL} The {@link URL} created for the shortened <code>url</code> or <code>null</code> if <code>url</code>\n   * is <code>null</code>.\n   * @public\n   */\n  url: function(url) {\n    return url ? new URL(url) : null\n  },\n\n  /**\n   * Retrieves the version of the connected YOURLS API.\n   *\n   * Optionally, <code>db</code> can be passed to indicate that the YOURLS database version should also be included in\n   * the result.\n   *\n   * @param {boolean} [db] - <code>true</code> to include the database version; otherwise <code>false</code>\n   * @param {Function} callback - the callback function to be called with the result\n   * @return {YOURLS} A reference to this {@link YOURLS} for chaining purposes.\n   * @public\n   */\n  version: function(db, callback) {\n    var data = { action: 'version' }\n\n    if (typeof db === 'function') {\n      callback = db\n      db = null\n    }\n\n    if (db != null) {\n      data.db = Number(db)\n    }\n\n    this.sendRequest(data, [ 'db_version', 'version' ], callback)\n\n    return this\n  }\n\n}, {\n\n  /**\n   * Sanitizes the result of {@link YOURLS#stats} so that it's more usable in application code by transforming the links\n   * from an object mapping into an array.\n   *\n   * This method simply returns <code>result</code> if it is <code>null</code>, has no links property or one that is\n   * already an array (future-proofing).\n   *\n   * @param {Object} result - the result to be sanitized (may be <code>null</code>)\n   * @param {Object} [result.links] - the links to be transformed into an array (may be <code>null</code>)\n   * @return {Object} The modified <code>result</code> or <code>null</code> if <code>result</code> is <code>null</code>.\n   * @private\n   * @static\n   */\n  _sanitizeStatsResult: function(result) {\n    // Future-proofing by sanitizing links *only* when not already an array\n    if (!result || !result.links || isArray(result.links)) {\n      return result\n    }\n\n    var index = 1\n    var link\n    var links = []\n\n    while ((link = result.links['link_' + index]) != null) {\n      links.push(link)\n      index++\n    }\n\n    result.links = links\n\n    return result\n  }\n\n})\n\n/**\n * The singleton instance of {@link YOURLS}.\n */\nexport default new YOURLS()\n\n/**\n * Contains criteria which can be used to search for a refined set of shortened URLs.\n *\n * Pagination can be achieved by using <code>limit</code> and <code>start</code>.\n *\n * No links will be returned unless <code>limit</code> is specified and has a value that is greater than zero.\n *\n * @typedef {Object} YOURLS~SearchCriteria\n * @property {string} [filter] - The filter to be applied (either <code>\"top\"</code>, <code>\"bottom\"</code>,\n * <code>\"rand\"</code>, or <code>\"last\"</code>).\n * @property {number} [limit] - The maximum number of links whose statistical information is to be counted.\n * <code>null</code> or <code>0</code> will result in no links being included in the result.\n * @property {number} [start] - The offset from where the search should begin.\n */\n\n/**\n * Contains additional information which can be used when shortening a URL.\n *\n * If <code>keyword</code> is specified, it must be available and, if not, the YOURLS server will generate a unique\n * keyword.\n *\n * @typedef {Object} YOURLS~UrlDescriptor\n * @property {string} [keyword] - The optional keyword to be used for the shortened URL.\n * @property {string} [title] - The optional title to be associated with the shortened URL.\n */\n"],"names":["extend","own","target","sources","slice","call","arguments","property","source","i","length","hasOwnProperty","create","prototype","properties","result","Object","Constructor","Oopsy","Array","isArray","obj","toString","constructor","statics","superConstructor","this","apply","super_","API","url","credentials","options","replace","_sanitizeCredentials","_sanitizeOptions","instance","signature","timestamp","password","username","format","toLowerCase","method","toUpperCase","Request","buildBody","api","data","getSupportedHttpMethods","isMethodSupported","supportedMethods","indexOf","isQueryStringRequired","process","body","callback","send","resultNames","_serializeParameters","response","_extractResult","names","name","params","results","push","encodeURIComponent","join","JSONRequest","xhr","XMLHttpRequest","open","onreadystatechange","readyState","JSON","parse","responseText","e","Error","setRequestHeader","seed","Date","getTime","JSONPRequest","window","_callbackHolderKey","_callbackHolder","_id","_generateId","script","document","createElement","self","parentNode","removeChild","setAttribute","getElementsByTagName","appendChild","Requestor","sendRequest","_requestFormatMap","request","json","jsonp","DB","stats","action","URL","expand","shorturl","YOURLS","db","VERSION","connect","disconnect","shorten","descriptor","keyword","title","criteria","limit","filter","start","_sanitizeStatsResult","version","Number","links","link","index"],"mappings":"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"}